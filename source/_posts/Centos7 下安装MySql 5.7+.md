title: CentOs7下安装Mysql5.7+版本
tags:
  - linux
  - mysql
  - 使用mysql
---
mysql 5.7及之后的版本有点小变化，本文基于centos 7进行mysql5.7版本的安装,
包括了基本安装，用户权限，及密码修改等操作。

<!-- more -->
### 安装前奏
1：去官网下载 5.7或以上版本的mysql tar.gz包

  下载地址： [link](https://www.mysql.com/downloads/)

2：使用root在Linux下创建 mysql用户及用户组
```
2.1：创建组

    [root@localhost]# groupadd mysql

2.2: 创建用户并加入到组中

    [root@localhost]# useradd -r -g mysql mysql

2.3: 禁止mysql用户登录系统（可选 防止别人使用mysql用户登录到主机）
    [root@localhost]# usermod -s /bin/false mysql
```
3: 将下载好的包放入到 /opt/mysql/ 下（目录按自己的喜好存储）
```
3.1：解压文件

    [root@localhost]# tar -xvf mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz

3.2: 修改解压好的目录命名

    [root@localhost]# mv mysql-5.7.21-linux-glibc2.12-x86_64 mysql-5.7.21

3.3: 更改目录所属的用户和组

    [root@localhost]# chown -R mysql mysql/

    [root@localhost]# chgrp -R mysql mysql/
```
***
### 开始安装Mysql
1. 进入到 /opt/mysql/mysql-5.7.21/support-files 目录下，查看是否有 my_default.cnf
如果没有执行1.1的步骤：

1.1. 在support-files目录下创建 my_default.cnf 文件

        [root@localhost]# mkdir my_default.cnf
1.2. 将以下内容复制到文件中
```
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html
# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.

[client]

port = 3306
socket = /opt/mysql/mysql.sock

[mysqld]

# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M

# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin

# These are commonly set, remove the # and set as required.
# basedir = .....
# datadir = .....
# port = .....
# server_id = .....
# socket = .....
#skip-grant-tables #跳过登录验证
#innodb_force_recovery=1
basedir = /opt/mysql/mysql-5.7.21/
datadir = /opt/mysql/data/
port = 3306
server_id = 1
socket = /opt/mysql/mysql.sock
language = /opt/mysql/mysql-5.7.21/share/english
#log-bin = /opt/mysql/mysql-5.7.21/mysql-bin
expire_logs_days = 10
max_binlog_size = 100M

#general_log = 1
#general_log_file = /opt/mysql/mysql-5.7.21/logs/query.log

slow_query_log = 1
slow_query_log_file = /opt/mysql/mysql-5.7.21/logs/slow-query.log
long-query_time = 2

log-error = /opt/mysql/mysql-5.7.21/logs/error.log

# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M

sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES

```
2. 将该文件移到/etc/目录下并改名
```
1: mysql 启动默认读取/etc/my.cnf配置文件,使用命令将文件挪到该目录

[root@localhost support-files]# mv my_default.cnf /etc/my.cnf
```

3. 将/opt/mysql/mysql-5.7.21/supprot-files/mysql.server 移动到 /etc/init.d/
```
[root@localhost]#  mv /opt/mysql/mysql-5.7.21/supprot-files/mysql.server /etc/init.d/mysqld
```
4.创建mysql的数据存储目录以及日志目录
```
1：创建data目录

[root@localhost]# mkdir /opt/mysql/data

2: 创建日志目录及日志文件，如果不创建启动会报错

[root@localhost]# mkdir /opt/mysql/mysql-5.7.21/logs

[root@localhost]# touch /opt/mysql/mysql-5.7.21/logs/error.log

```
5. 配置 my.cnf 文件

```
1：修改 my.cnf
[root@localhost etc]# vi /etc/my.cnf
 basedir = /opt/mysql/mysql-5.7.21（mysql安装目录）
 datadir = /opt/mysql/data (上一步创建的data路径)
 socket = /opt/mysql/mysql.sock （该文件会自动创建在你指定的位置）
 log*的配置：只需要改一些log存放的路径，上一步已经创建了logs目录，把所以关于log的路径都指向 /opt/mysql/mysql-5.7.21/logs目录
```
6. 一切就绪准备安装服务
```
1：进入到Mysql bin目录下执行命令
[root@localhost bin]# ./mysqld --initialize-insecure --user=mysql --basedir=/opt/mysql/mysql-5.7.21/ --datadir=/opt/mysql/data/
如果上不没有ERROR 就表示安装成功

```
7：启动服务

进入到 /etc/init.d/下执行启动命令：
[root@localhost init.d] ./mysqld start

执行完毕看到 Mysql Start SUCCESS 表示成功

8：连接到mysql服务端

```
1. 进入到mysql bin目录下执行命令
[root@localhost bin] ./mysql -uroot -p
输入密码即可连接
```
9： 忘记了root密码
~~~
1. 先停止已启动服务
[root@localhost init.d] ./mysqld stop
2. 修改my.cnf文件
[root@localhost etc] vi my.cnf
加入一行：skip-grant-tables #跳过登录验证
3. 重启mysql服务 ./mysqld start
4. bin目录下连接mysql : ./mysql
mysql> grant all privileges on *.* to 'root'@'localhost' identified by '123465' with grant option;
如果显示：The MySQL server is running with the --skip-grant-tables option so it cannot execute this statement
表示当前用户没有写入的权限，修改权限执行这组命令在执行上句命令
【 mysql> set global read_only=0;// 关掉数据库的只读属性
   mysql>flush privileges;// 刷新配置
】
如果无任何错误信息：执行 mysql>flush privileges

mysql> exit;
6:将my.cnf加上的跳过验证删除，然后在重启mysql服务。至此，mysql安装完成


第二中修改密码的方式：
按照第一步跳过验证的步骤登录mysql执行： ALTER USER 'root'@'localhost' IDENTIFIED BY 'root123';
授权远程登录：GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'mypassword' WITH GRANT OPTION;
FLUSH  PRIVILEGES;
~~~

10. 修改密码后依旧无法登陆
```
使用第9步骤跳过登陆验证，按如下指令操作
1. use mysql;
2. select plugin from user where user='root'; 检查该表中是否存在这个字段，如不存在执行 update user set plugin='mysql_native_password';
3. 执行密码修改 update user set authentication_string=password('123456') where user='root' and host='localhost';
4. 刷新权限 flush privileges;
5. 去掉跳过验证，重启服务即可

```

***
## 创建用户，授权
***
###  创建用户
1. 命令:
```
CREATE USER 'username'@'host' IDENTIFIED BY 'password';
```
2. 例子:
```
CREATE USER 'dog'@'localhost' IDENTIFIED BY '123456';

CREATE USER 'dog2'@'localhost' IDENTIFIED BY '';
```

<font color=red size=4>
 PS：username - 你将创建的用户名,
 host - 指定该用户在哪个主机上可以登陆，此处的"localhost"，是指该用户只能在本地登录，不能在另外一台机器上远程登录，如果想远程登录的话，将"localhost"改为"%"，表示在任何一台电脑上都可以登录;也可以指定某台机器可以远程登录;
 password - 该用户的登陆密码,密码可以为空,如果为空则该用户可以不需要密码登陆服务器。
</font>

***
### 授权
1. 命令:
```
GRANT privileges ON databasename.tablename TO 'username'@'host'
```
<font color=red size=4>
PS: privileges - 用户的操作权限,如SELECT , INSERT , UPDATE 等(详细列表见该文最后面).如果要授予所的权限则使用ALL.;databasename - 数据库名,tablename-表名,如果要授予该用户对所有数据库和表的相应操作权限则可用*表示, 如*.*.
</font>

例子:
```
GRANT SELECT, INSERT ON mq.* TO 'dog'@'localhost';
```
***
### 创建用户同时授权
```
mysql> grant all privileges on mq.* to test@localhost identified by '1234';
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> flush privileges;
Query OK, 0 rows affected (0.01 sec)
```
PS:必须执行flush privileges;

否则登录时提示：ERROR 1045 (28000): Access denied for user 'user'@'localhost' (using password: YES )
***
### 设置与更改用户密码
命令:
```
SET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword');
```
### 撤销用户权限
命令:
```
REVOKE privilege ON databasename.tablename FROM 'username'@'host';
```
说明: privilege, databasename, tablename - 同授权部分.

<font color=red size=4>
PS: 假如你在给用户'dog'@'localhost''授权的时候是这样的(或类似的):GRANT SELECT ON test.user TO 'dog'@'localhost', 则在使用REVOKE SELECT ON *.* FROM 'dog'@'localhost';命令并不能撤销该用户对test数据库中user表的SELECT 操作.相反,如果授权使用的是GRANT SELECT ON *.* TO 'dog'@'localhost';则REVOKE SELECT ON test.user FROM 'dog'@'localhost';命令也不能撤销该用户对test数据库中user表的Select 权限.
</font>

>具体信息可以用命令SHOW GRANTS FOR 'dog'@'localhost'; 查看.

### 查看用户的授权
```
mysql> show grants for dog@localhost;
```
